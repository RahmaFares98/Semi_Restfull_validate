<!DOCTYPE html>
<html>
<head>
    <title>Edit Show</title>
</head>
<body>
    <h1>Edit TV Show</h1>
    <form action="/shows/{{ show.id }}/update" method="POST">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Update Show</button>
    </form>
    {% if form.errors %}
        <p style="color: red;">Please correct the errors below:</p>
        <ul>
        {% for field, errors in form.errors.items %}
            {% for error in errors %}
                <li>{{ error }}</li>
            {% endfor %}
        {% endfor %}
        </ul>
    {% endif %}
</body>
<!-- new_show.html and edit_show.html -->
{% block content %}
<h1>{% block title %}{% endblock %}</h1>
<form action="/shows/create" method="POST" id="showForm">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Add Show</button>
</form>
<div id="errorMessages" style="color: red;"></div>

<script type="text/javascript">
$(document).ready(function() {
    $('#showForm').submit(function(event) {
        event.preventDefault();
        var formData = $(this).serialize();
        $.ajax({
            type: 'POST',
            url: '/shows/check_unique_title/',
            data: formData,
            success: function(response) {
                if (response.is_taken) {
                    $('#errorMessages').html('<p>Title already exists. Please choose a different title.</p>');
                } else {
                    $('#showForm').unbind('submit').submit();
                }
            },
            error: function(error) {
                console.log(error);
            }
        });
    });
});
</script>
{% endblock %}

</html>
